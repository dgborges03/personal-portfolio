---
import Layout from "../../layouts/Layout.astro";
import { projects } from "../../data/projects.js";

export async function getStaticPaths() {
  return projects.map((p) => ({
    params: { id: p.id },
    props: { project: p },
  }));
}

const { project } = Astro.props;
const video = project.video;
const heroImage = project.detailImage || project.image;
---
<Layout>
  <article class="mx-auto max-w-3xl px-4 sm:px-6 lg:px-8 py-12">
    <header>
      <h1 class="text-3xl font-semibold">{project.title}</h1>
      <p class="mt-2 text-sm text-zinc-500">
        {project.year}{project.role ? ` · ${project.role}` : ""}
      </p>
    </header>

    <!-- Hero media -->
    {video ? (
      <div class="mt-6 aspect-video w-full overflow-hidden rounded-xl border">
        {video.type === "youtube" && (
          <iframe
            src={`https://www.youtube.com/embed/${video.id}?autoplay=1&mute=1&controls=1&rel=0&modestbranding=1&playsinline=1`}
            title={`${project.title} demo video`}
            frameborder="0"
            allow="autoplay; encrypted-media; picture-in-picture; clipboard-write"
            allowfullscreen
            class="h-full w-full"
          ></iframe>
        )}

        {video.type === "vimeo" && (
          <iframe
            src={`https://player.vimeo.com/video/${video.id}?autoplay=1&muted=1&title=0&byline=0&portrait=0&playsinline=1`}
            title={`${project.title} demo video`}
            frameborder="0"
            allow="autoplay; fullscreen; picture-in-picture"
            allowfullscreen
            class="h-full w-full"
          ></iframe>
        )}

        {video.type === "mp4" && (
          <video
            src={video.src}
            autoplay
            muted
            playsinline
            controls
            class="h-full w-full object-cover"
            poster={heroImage}
          ></video>
        )}
      </div>
    ) : (
      heroImage && (
        <img
          src={heroImage}
          alt={project.title}
          class="mt-6 w-full rounded-xl border"
          loading="lazy"
        />
      )
    )}

    <p class="mt-6 text-zinc-700">{project.summary}</p>

    {project.bullets?.length > 0 && (
      <ul class="mt-6 list-disc pl-5 space-y-1 text-zinc-700">
        {project.bullets.map((b) => <li>{b}</li>)}
      </ul>
    )}

    {project.tags?.length > 0 && (
      <ul class="mt-6 flex flex-wrap gap-2">
        {project.tags.map((t) => (
          <li class="rounded-full border px-2 py-1 text-xs text-zinc-700">{t}</li>
        ))}
      </ul>
    )}

    {project.links?.length > 0 && (
      <div class="mt-8 flex flex-wrap gap-3">
        {project.links.map((l) => (
          <a
            href={l.href}
            target="_blank"
            rel="noreferrer"
            class="rounded-lg border px-3 py-1.5 text-sm hover:bg-zinc-50"
          >
            {l.label}
          </a>
        ))}
      </div>
    )}

    <!-- Nacho-only shoutout to Maxx the goat -->
    {project.id === "nacho" && (
      <div class="mt-6 p-4 border rounded-xl bg-zinc-50">
        <p class="text-sm text-zinc-700">
          Special thanks to{" "}
          <a
            href="https://maxxiba.wordpress.com/"
            target="_blank"
            rel="noreferrer"
            class="underline underline-offset-4 font-medium"
          >
            Maxx Ibarra
          </a>{" "}
          for helping with this project!
        </p>
      </div>
    )}

    <div class="mt-10">
      <a href="/#projects" class="text-sm underline underline-offset-4">← Back to projects</a>
    </div>
  </article>
</Layout>
